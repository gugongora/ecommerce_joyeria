{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load user_groups %}

{% block content %}
<div class="max-w-4xl mx-auto p-6">

  <!-- Mensaje de éxito -->
  {% if messages %}
    <div class="mb-4">
      {% for message in messages %}
        <div class="bg-emerald-100 border border-emerald-300 text-emerald-800 px-4 py-3 rounded">
          ✔ {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <h2 class="text-xl font-semibold mb-4">Detalle del Pedido #{{ order.id }}</h2>
  <p><strong>Usuario:</strong> {{ order.user.username }}</p>

  {% if user.is_authenticated and user|has_group:"personal_interno" %}
    <form method="post" class="mt-2 mb-4">
      {% csrf_token %}
      <label for="status" class="font-semibold mr-2">Estado:</label>
      <select name="status" id="status" class="border px-2 py-1 rounded">
        <option value="pending" {% if order.status == "pending" %}selected{% endif %}>Pendiente</option>
        <option value="paid" {% if order.status == "paid" %}selected{% endif %}>Pagado</option>
        <option value="cancelled" {% if order.status == "cancelled" %}selected{% endif %}>Cancelado</option>
      </select>
      <button type="submit" class="ml-2 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded">
        Guardar
      </button>
    </form>
  {% else %}
    <p><strong>Estado:</strong> {{ order.status }}</p>
  {% endif %}

  <p><strong>Total:</strong> ${{ order.total|intcomma }}</p>
  <p><strong>Fecha:</strong> {{ order.created_at|date:"d M Y H:i" }}</p>

  <h3 class="text-lg font-medium mt-6 mb-2">Productos</h3>
  <ul class="space-y-3">
    {% for item in items %}
      <li class="p-4 border rounded shadow-sm">
        <p><strong>Producto:</strong> {{ item.product_name }}</p>
        <p><strong>Cantidad:</strong> {{ item.quantity }}</p>
        <p><strong>Subtotal:</strong> ${{ item.subtotal|intcomma }}</p>
      </li>
    {% empty %}
      <li>No hay productos asociados.</li>
    {% endfor %}
  </ul>

  <a href="{% url 'orders:dashboard_pedidos' %}" class="mt-6 inline-block bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-4 rounded">← Volver</a>
</div>
{% endblock %}
