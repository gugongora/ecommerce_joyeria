{% extends 'base.html' %}
{% block main_classes %}pt-[20px] flex-grow w-full p-0 m-0 pb-2{% endblock %}
{% load static %}
{% get_static_prefix as STATIC %}
{% load user_groups %}

{% block hero %}

<!-- Carrusel Hero - Full width corregido -->
<div class="relative overflow-hidden mb-4 shadow-lg h-[900px] w-full">
  <div class="relative h-full w-full overflow-hidden">

    <!-- Slide 1 -->
    <div class="absolute inset-0 transition-opacity duration-1000 opacity-100 carousel-item">
      <img src="{% static 'images/carrusel1.jpg' %}" alt="Carrusel 1"
           class="absolute inset-0 h-full w-full object-cover z-0" />
      <div class="relative z-10 h-full w-full flex flex-col justify-center items-start text-left px-12 max-w-2xl">
        <h2 class="text-5xl font-bold text-white mb-4 drop-shadow-lg leading-tight">
          Joyas hechas a medida con alma y oficio
        </h2>
        <p class="text-white text-lg mb-6 drop-shadow">Diseños únicos y reparaciones que perduran en el tiempo.</p>
        <a href="#catalogo"
           class="bg-transparent border border-white text-white font-semibold px-5 py-2 rounded hover:bg-white hover:text-gray-900 transition">
          Solicitar diseño personalizado
        </a>
      </div>
    </div>

    <!-- Slide 2 -->
    <div class="absolute inset-0 transition-opacity duration-1000 opacity-0 carousel-item">
      <img src="{% static 'images/carrusel2.jpg' %}" alt="Carrusel 2"
           class="absolute inset-0 h-full w-full object-cover z-0" />
      <div class="relative z-10 h-full w-full flex flex-col justify-center items-start text-left px-12 max-w-2xl">
        <h2 class="text-5xl font-bold text-white mb-4 drop-shadow-lg leading-tight">
          Hecho a tu medida
        </h2>
        <p class="text-white text-lg mb-6 drop-shadow">Creamos y restauramos piezas que cuentan tu historia.</p>
        <a href="#catalogo"
           class="bg-transparent border border-white text-white font-semibold px-5 py-2 rounded hover:bg-white hover:text-gray-900 transition">
          Comprar ahora
        </a>
      </div>
    </div>


    <!-- Indicadores tipo "dots" -->
    <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 z-20 flex space-x-3" id="carousel-dots">
      <button class="w-3 h-3 rounded-full bg-white opacity-60 hover:opacity-100 transition" data-slide="0"></button>
      <button class="w-3 h-3 rounded-full bg-white opacity-30 hover:opacity-100 transition" data-slide="1"></button>
    </div>

  </div>
</div>


  </div>
</div>
{% endblock %}

{% block content %}
<!-- Catálogo de productos tipo slider con flechas -->
<div id="catalogo" class="w-full pt-2 pb-8 relative overflow-x-hidden">
  <h2 class="text-2xl font-semibold text-center text-gray-800 mb-6">Catálogo de Productos</h2>

  <!-- Contenedor con flechas -->
  <div class="relative w-full overflow-x-hidden">
    
    <!-- Botón izquierda -->
    <button id="prevBtn" class="absolute left-2 top-1/2 -translate-y-1/2 z-50 bg-[#5e0013] text-white rounded-full p-2 hover:bg-[#83041e] shadow-md">
      <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
      </svg>
    </button>

    <!-- Slider -->
    <div id="product-slider" class="flex overflow-x-auto space-x-6 scrollbar-hide py-4 scroll-smooth w-full">
      <p class="text-gray-500 ml-6">Cargando productos...</p>
    </div>

    <!-- Botón derecha -->
    <button id="nextBtn" class="absolute right-2 top-1/2 -translate-y-1/2 z-50 bg-[#5e0013] text-white rounded-full p-2 hover:bg-[#83041e] shadow-md">
      <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
      </svg>
    </button>

  </div>
</div>




<!-- Ocultar scrollbar -->
<style>
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>


<!-- Servicios destacados del Maestro Orfebre - Estilo expandido 2 columnas -->
<section class="w-full py-10 bg-white">
  <h3 class="text-3xl font-semibold text-center text-gray-800 mb-12">Servicios destacados</h3>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-0">
    
    <!-- Pedidos Personalizados -->
    <div class="relative w-full h-[550px] overflow-hidden group">
      <img src="{% static 'images/servicios/pedidos.jpg' %}" alt="Pedidos exclusivos" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
      <div class="absolute bottom-0 left-0 right-0 bg-white bg-opacity-90 p-6 text-center">
        <h4 class="text-lg font-semibold text-gray-800 uppercase mb-2">Pedidos Exclusivos</h4>
        <a href="{% url 'store:quienes_somos' %}#personalizados" class="inline-block border border-gray-800 text-gray-800 px-4 py-2 rounded hover:bg-gray-800 hover:text-white transition">VER MÁS</a>
      </div>
    </div>

    <!-- Argollas de Matrimonio -->
    <div class="relative w-full h-[550px] overflow-hidden group">
      <img src="{% static 'images/servicios/argollas.jpg' %}" alt="Argollas de matrimonio" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
      <div class="absolute bottom-0 left-0 right-0 bg-white bg-opacity-90 p-6 text-center">
        <h4 class="text-lg font-semibold text-gray-800 uppercase mb-2">Argollas de Matrimonio</h4>
        <a href="{% url 'store:quienes_somos' %}#argollas" class="inline-block border border-gray-800 text-gray-800 px-4 py-2 rounded hover:bg-gray-800 hover:text-white transition">VER MÁS</a>
      </div>
    </div>




    <!-- Reparaciones -->
    <div class="relative w-full h-[550px] overflow-hidden group">
      <img src="{% static 'images/servicios/reparaciones.jpg' %}" alt="Reparaciones" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
      <div class="absolute bottom-0 left-0 right-0 bg-white bg-opacity-90 p-6 text-center">
        <h4 class="text-lg font-semibold text-gray-800 uppercase mb-2">Reparaciones</h4>
        <a href="{% url 'store:quienes_somos' %}#reparaciones" class="inline-block border border-gray-800 text-gray-800 px-4 py-2 rounded hover:bg-gray-800 hover:text-white transition">VER MÁS</a>
      </div>
    </div>





    <!-- Garantía y Ajustes -->
    <div class="relative w-full h-[550px] overflow-hidden group">
      <img src="{% static 'images/servicios/garantia.jpg' %}" alt="Garantía y ajustes" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
      <div class="absolute bottom-0 left-0 right-0 bg-white bg-opacity-90 p-6 text-center">
        <h4 class="text-lg font-semibold text-gray-800 uppercase mb-2">Garantía & Ajustes</h4>
        <a href="{% url 'store:quienes_somos' %}#garantia" class="inline-block border border-gray-800 text-gray-800 px-4 py-2 rounded hover:bg-gray-800 hover:text-white transition">VER MÁS</a>
      </div>
    </div>

  </div>
</section>





<!-- Sección Somos -->
<section class="w-full flex flex-col lg:flex-row mt-10">

  <!-- Imagen lado izquierdo -->
  <div class="w-full lg:w-1/2 h-[500px]">
    <img src="{% static 'images/somos-joyas.jpg' %}" alt="Joyas en arena" class="w-full h-full object-cover">
  </div>

  <!-- Texto con fondo lado derecho -->
  <div class="w-full lg:w-1/2 h-[500px] relative bg-cover bg-center" style="background-image: url('{% static 'images/somos-fondo.jpg' %}');">
    <div class="absolute inset-0 bg-[#5e0013]/60"></div> <!-- Capa oscura semi-transparente -->
    <div class="relative z-10 text-white p-10 flex flex-col justify-center h-full">
      <h3 class="text-2xl md:text-3xl font-semibold mb-4">SOMOS</h3>
      <p class="mb-4">
        Nuestras obras son una delicada combinación de esmero, talento y experiencia.
      </p>
      <p class="mb-4">
        Descubra las piezas de joyería que creamos hoy con pasión y con la trayectoria del legado acumulado por más de medio siglo en el oficio de la orfebrería.
      </p>
      <p class="mb-6">
        Trabajamos con un equipo de maestros orfebres de excelencia para materializar diseños únicos que lo acompañarán a través del tiempo, convirtiéndose en fiel reflejo de su historia.
      </p>
      <a href="{% url 'store:quienes_somos' %}" class="border border-white px-5 py-2 text-white hover:bg-white hover:text-[#5e0013] transition w-fit">
        ver más
      </a>
    </div>
  </div>

</section>

<!-- Beneficios Artesanales -->
<section class="bg-white border-t border-gray-300 py-10">
  <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8 text-center text-sm text-gray-700">
    
    <!-- Atención personalizada -->
    <div>
      <i class="fas fa-hands-helping text-2xl text-[#5e0013] mb-2"></i>
      <h4 class="font-bold mb-1">Atención Personalizada</h4>
      <p>Te acompañamos en cada paso para crear la pieza perfecta, única y significativa.</p>
    </div>

    <!-- Hecho a mano -->
    <div>
      <i class="fas fa-gem text-2xl text-[#5e0013] mb-2"></i>
      <h4 class="font-bold mb-1">Joyas Hechas a Mano</h4>
      <p>Diseños elaborados artesanalmente con precisión, esmero y tradición orfebre.</p>
    </div>

    <!-- Entrega especial -->
    <div>
      <i class="fas fa-box-open text-2xl text-[#5e0013] mb-2"></i>
      <h4 class="font-bold mb-1">Presentación con Historia</h4>
      <p>Cada pieza se entrega en estuche de madera, acompañada de su certificado artesanal.</p>
    </div>

    <!-- Garantía -->
    <div>
      <i class="fas fa-shield-alt text-2xl text-[#5e0013] mb-2"></i>
      <h4 class="font-bold mb-1">Garantía y Reparaciones</h4>
      <p>Respaldamos nuestro trabajo con garantía y servicio de mantenimiento especializado.</p>
    </div>

  </div>
</section>




<!-- Carrusel JS -->
<script>
  const productSlider = document.getElementById('product-slider');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  function cargarProductosDesdeAPI() {
    const urlParams = new URLSearchParams(window.location.search);
    const categoria = urlParams.get('categoria');
    const marca = urlParams.get('marca');

    let apiURL = `${API_BASE_URL}productos/`;
    const filtros = [];

    if (categoria) filtros.push(`categoria=${categoria}`);
    if (marca) filtros.push(`marca=${marca}`);
    if (filtros.length > 0) apiURL += '?' + filtros.join('&');

    fetch(apiURL)
      .then(response => {
        if (!response.ok) throw new Error(`Error al obtener productos: ${response.status}`);
        return response.json();
      })
      .then(data => {
        productSlider.innerHTML = '';

        if (!data.results || data.results.length === 0) {
          productSlider.innerHTML = '<p class="text-center text-red-600">No hay productos disponibles.</p>';
          return;
        }

        data.results.forEach(product => {
          const card = document.createElement('div');
          card.className = 'min-w-[250px] bg-white border border-gray-200 rounded-lg shadow p-4 hover:shadow-lg transition duration-300 flex-shrink-0';

          const imageSrc = product.imagen_url || '{% static "images/no-image.jpg" %}';
          const precio = product.precio_actual ?? 0;

          card.innerHTML = `
            <img src="${imageSrc}" alt="${product.nombre}" class="w-full h-40 object-cover rounded mb-3">
            <h3 class="text-base font-semibold text-gray-800 mb-1">${product.nombre}</h3>
            <p class="text-sm text-gray-600 mb-2">${product.descripcion?.slice(0, 60) || ''}</p>
            <p class="text-lg font-bold text-gray-900 mb-3">$${precio}</p>
            <div class="flex flex-col gap-2">
              <a href="/store/producto/${product.id}/" 
                 class="text-center border border-black text-black hover:bg-black hover:text-white font-medium py-1.5 rounded">
                Ver detalles
              </a>
              <form action="/cart/add/${product.id}/" method="post">
                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                <button type="submit" 
                        class="w-full bg-black hover:bg-gray-800 text-white font-medium py-1.5 rounded">
                  Agregar al carrito
                </button>
              </form>
            </div>
          `;

          productSlider.appendChild(card);
        });
      })
      .catch(error => {
        productSlider.innerHTML = `<p class="text-center text-red-600">Error: ${error.message}</p>`;
      });
  }

  document.addEventListener('DOMContentLoaded', () => {
    cargarProductosDesdeAPI();

    prevBtn.addEventListener('click', () => {
      productSlider.scrollBy({ left: -300, behavior: 'smooth' });
    });

    nextBtn.addEventListener('click', () => {
      productSlider.scrollBy({ left: 300, behavior: 'smooth' });
    });
  });
</script>


<script>
  const slides = document.querySelectorAll('.carousel-item');
  const dots = document.querySelectorAll('#carousel-dots button');
  let currentSlide = 0;

  function showSlide(index) {
    slides.forEach((slide, i) => {
      slide.style.opacity = (i === index) ? '1' : '0';
    });
    dots.forEach((dot, i) => {
      dot.classList.toggle('opacity-60', i === index);
      dot.classList.toggle('opacity-30', i !== index);
    });
    currentSlide = index;
  }

  dots.forEach(dot => {
    dot.addEventListener('click', () => {
      const index = parseInt(dot.dataset.slide);
      showSlide(index);
    });
  });

  // Opcional: rotación automática cada 6 segundos
  setInterval(() => {
    const next = (currentSlide + 1) % slides.length;
    showSlide(next);
  }, 10000);

  // Mostrar primer slide por defecto
  showSlide(0);
</script>




{% endblock %}
